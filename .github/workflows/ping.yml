name: ðŸ”¥ Keep Replit Alive
on:
  schedule:
    - cron: '*/7 * * * *'  # Health check every 7 minutes
    - cron: '*/5 * * * *'  # Warmup every 5 minutes  
  workflow_dispatch:       # Manual trigger

jobs:
  health-check:
    name: ðŸ©º Health Check
    if: github.event.schedule == '*/7 * * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Check Replit Health
        run: |
          echo "ðŸ©º Checking Replit health..."
          curl -s -X GET "${{ secrets.REPLIT_URL }}/health" \
            -H "X-API-Key: ${{ secrets.REPLIT_API_KEY }}" \
            -H "Content-Type: application/json" \
            -w "HTTP Status: %{http_code}\n"
          echo "âœ… Health check completed at $(date)"

  warm-up:
    name: ðŸ”¥ Warm Up
    if: github.event.schedule == '*/5 * * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Warm Up Replit
        run: |
          echo "ðŸ”¥ Warming up Replit..."
          curl -s -X POST "${{ secrets.REPLIT_URL }}/warmup" \
            -H "X-API-Key: ${{ secrets.REPLIT_API_KEY }}" \
            -H "Content-Type: application/json" \
            -w "HTTP Status: %{http_code}\n"
          echo "âœ… Warmup completed at $(date)"

  status:
    name: ðŸ“Š Status Report
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Final Status
        run: |
          echo "ðŸ“Š Cronjob Execution Report"
          echo "============================"
          echo "Workflow: ${{ github.workflow }}"
          echo "Trigger: ${{ github.event_name }}"
          echo "Schedule: ${{ github.event.schedule }}"
          echo "Time: $(date)"
          echo "Repository: ${{ github.repository }}"
          echo "============================"
