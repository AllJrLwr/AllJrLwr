name: ğŸ”¥ Keep Replit Alive

on:
  schedule:
    - cron: '*/7 * * * *'  # Health check every 7 minutes
    - cron: '*/5 * * * *'  # Warmup every 5 minutes  
  workflow_dispatch:       # Manual trigger

jobs:
  health-check:
    name: ğŸ©º Health Check
    if: github.event.schedule == '*/7 * * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Check Replit Health
        run: |
          echo "ğŸ©º Checking Replit health..."
          response=$(curl -s -o /tmp/response_body -w "%{http_code}" \
            -X GET "${{ secrets.REPLIT_URL }}/health" \
            -H "Content-Type: application/json")
          echo "HTTP Status: $response"
          cat /tmp/response_body
          if [ "$response" -ge 300 ]; then
            echo "âš ï¸ Warning: HTTP status $response"
          else
            echo "âœ… Health check completed at $(date)"
          fi

  warm-up:
    name: ğŸ”¥ Warm Up
    if: github.event.schedule == '*/5 * * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Warm Up Replit
        run: |
          echo "ğŸ”¥ Warming up Replit..."
          response=$(curl -s -o /tmp/response_body -w "%{http_code}" \
            -X GET "${{ secrets.REPLIT_URL }}/warmup" \
            -H "Content-Type: application/json")
          echo "HTTP Status: $response"
          cat /tmp/response_body
          if [ "$response" -ge 300 ]; then
            echo "âš ï¸ Warning: HTTP status $response"
          else
            echo "âœ… Warmup completed at $(date)"
          fi

  status:
    name: ğŸ“Š Status Report
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Final Status
        run: |
          echo "ğŸ“Š Cronjob Execution Report"
          echo "============================"
          echo "Workflow: ${{ github.workflow }}"
          echo "Trigger: ${{ github.event_name }}"
          echo "Schedule: ${{ github.event.schedule }}"
          echo "Time: $(date)"
          echo "Repository: ${{ github.repository }}"
          echo "============================"
